---
/**
 * Session Lifecycle Chart (Phase 4A)
 * Visualizes admission hour distribution from session_lifecycle.json
 * Chart shows when sessions are typically admitted (hourly distribution)
 */
import type { SessionLifecycleData } from '../lib/artifactsData';

interface Props {
  data: SessionLifecycleData;
}

const { data } = Astro.props;
const chartId = `sessionLifecycleChart-${Math.random().toString(36).substr(2, 9)}`;
---

<div class="chart-wrapper">
  <h4 class="chart-heading">Admission Pattern</h4>
  <div class="chart-container">
    <canvas id={chartId}></canvas>
  </div>
</div>

<script define:vars={{ data, chartId }}>
  // Import Chart.js dynamically when page loads
  import('https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js').then((module) => {
    const Chart = module.default;
    
    // Extract admission hour distribution
    const distribution = data.admission_hour_distribution || [];
    const labels = distribution.map(h => `${String(h.hour).padStart(2, '0')}:00`);
    const values = distribution.map(h => h.count);
    
    // Configure Chart.js with dark theme
    const ctx = document.getElementById(chartId);
    if (ctx) {
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Sessions Admitted',
            data: values,
            backgroundColor: 'rgba(0, 188, 212, 0.2)',
            borderColor: '#00bcd4',
            borderWidth: 2,
            fill: true,
            tension: 0.1,
            pointBackgroundColor: '#00bcd4',
            pointBorderColor: '#00bcd4',
            pointHoverBackgroundColor: '#f0f0f0',
            pointHoverBorderColor: '#00bcd4',
            pointRadius: 3,
            pointHoverRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          aspectRatio: 3,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              backgroundColor: '#222222',
              titleColor: '#f0f0f0',
              bodyColor: '#b0b0b0',
              borderColor: '#2d2d2d',
              borderWidth: 1,
              padding: 12,
              displayColors: false
            }
          },
          scales: {
            x: {
              ticks: {
                color: '#b0b0b0',
                maxRotation: 45,
                minRotation: 45
              },
              grid: {
                color: '#2d2d2d'
              }
            },
            y: {
              beginAtZero: true,
              ticks: {
                color: '#b0b0b0',
                precision: 0
              },
              grid: {
                color: '#2d2d2d'
              }
            }
          }
        }
      });
    }
  });
</script>

<style>
  .chart-wrapper {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .chart-heading {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .chart-container {
    background: var(--panel);
    border-radius: var(--radius-md);
    padding: 1.5rem;
    border: 1px solid var(--border);
  }

  canvas {
    max-width: 100%;
    height: auto;
  }
</style>
