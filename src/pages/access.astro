---
import BaseLayout from '../layouts/BaseLayout.astro';
import PageHero from '../components/PageHero.astro';
import fs from 'node:fs';
import path from 'node:path';

// Load archive statistics for context
let archiveStats = null;
try {
  const archiveStatsPath = path.join(process.cwd(), 'public/data/archive_stats.json');
  archiveStats = JSON.parse(fs.readFileSync(archiveStatsPath, 'utf-8'));
} catch (error) {
  console.error('Failed to load archive stats:', error);
}

// Tier configuration
const tiers = [
  {
    name: 'Explorer',
    price: 5,
    description: 'Lightweight sentiment screening',
    features: [
      '19 flat columns',
      'Sentiment summary (pos/neu/neg counts)',
      'Spot price + spread + 24h change',
      'Final liquidity score',
      'Daily parquet files (~175 KB/day)',
    ],
    useCases: 'Quick screening, correlation studies, learning',
    patreonUrl: '#', // Placeholder - will be updated
    tier: 'Tier 1',
  },
  {
    name: 'Researcher',
    price: 15,
    description: 'Full market microstructure + sentiment',
    features: [
      '8 nested column groups',
      'Order book depth at multiple levels',
      'Multi-window sentiment (last cycle + 2 cycles)',
      'Derived analytics (depth imbalance, flow)',
      'Daily parquet files (~0.8 MB/day)',
    ],
    useCases: 'Research, dashboards, analysis workflows',
    patreonUrl: '#', // Placeholder - will be updated
    tier: 'Tier 2',
    highlighted: true,
  },
  {
    name: 'Full Archive',
    price: 35,
    description: 'Complete data for ML and backtesting',
    features: [
      '12 nested column groups',
      '700+ price samples per entry (~10s intervals)',
      'Futures data (funding rate, open interest)',
      'Full sentiment windows with engagement',
      'Daily parquet files (~10 MB/day)',
    ],
    useCases: 'ML training, backtesting, quantitative research',
    patreonUrl: '#', // Placeholder - will be updated
    tier: 'Tier 3',
  },
];

const faqs = [
  {
    question: 'How do I access the data after subscribing?',
    answer: 'After subscribing on Patreon, you will receive access to private download links for your tier. Data is hosted on Cloudflare R2 with fast global delivery.',
  },
  {
    question: 'What format is the data in?',
    answer: 'All tiers provide Apache Parquet files (zstd compressed). This format is widely supported by Python (PyArrow, Pandas), DuckDB, and most data tools.',
  },
  {
    question: 'How often is the data updated?',
    answer: 'New daily files are published every 24 hours. You get access to the full historical archive plus all future updates while subscribed.',
  },
  {
    question: 'Can I upgrade or downgrade my tier?',
    answer: 'Yes. You can change your tier at any time through Patreon. Upgrades take effect immediately; downgrades apply at the next billing cycle.',
  },
  {
    question: 'What does the data cover?',
    answer: 'Each entry is a ~2-hour observation session for a cryptocurrency trading pair on Binance. We track spot market data and aggregate X (Twitter) sentiment using a custom-trained DistilBERT model with a hybrid two-model arbitration system.',
  },
  {
    question: 'Is this real-time data?',
    answer: 'No. This is historical batch data updated daily. It is designed for research, analysis, and backtestingâ€”not live trading signals.',
  },
  {
    question: 'When is sentiment captured relative to price monitoring?',
    answer: 'Sentiment is captured in a ~1-hour window immediately prior to the 2-hour price monitoring session. When a coin enters the active watchlist, it is assigned the aggregated sentiment from the preceding Twitter scrape cycle. This creates a natural lead-time between sentiment observation and price evolution.',
  },
];
---

<BaseLayout 
  title="Data Access - Instrumetriq"
  description="Subscribe to Instrumetriq datasets: crypto market snapshots with X (Twitter) sentiment data."
>
  <PageHero
    eyebrow="ACCESS"
    title="Data Access"
    subtitle="Choose your tier and get daily crypto sentiment data."
  />
  
  <div class="pageContent">
    <!-- Archive context -->
    {archiveStats && (
      <div class="archive-context">
        <span class="context-item">
          <strong>{archiveStats.total_entries_all_time.toLocaleString()}</strong> entries archived
        </span>
        <span class="context-divider">â€¢</span>
        <span class="context-item">
          <strong>{archiveStats.total_days}</strong> days of data
        </span>
        <span class="context-divider">â€¢</span>
        <span class="context-item">
          Updated daily
        </span>
      </div>
    )}
    
    <!-- Pricing Cards -->
    <section class="pricing-section">
      <div class="pricing-grid">
        {tiers.map((tier) => (
          <div class={`pricing-card ${tier.highlighted ? 'highlighted' : ''}`}>
            <div class="card-header">
              <span class="tier-badge">{tier.tier}</span>
              <h3 class="tier-name">{tier.name}</h3>
              <p class="tier-description">{tier.description}</p>
            </div>
            
            <div class="card-price">
              <span class="price-currency">$</span>
              <span class="price-amount">{tier.price}</span>
              <span class="price-period">/month</span>
            </div>
            
            <ul class="feature-list">
              {tier.features.map((feature) => (
                <li class="feature-item">
                  <span class="feature-check">âœ“</span>
                  {feature}
                </li>
              ))}
            </ul>
            
            <p class="use-cases">
              <strong>Best for:</strong> {tier.useCases}
            </p>
            
            <a href={tier.patreonUrl} class="subscribe-button" target="_blank" rel="noopener noreferrer">
              Subscribe on Patreon â†’
            </a>
          </div>
        ))}
      </div>
    </section>
    
    <!-- What's Included -->
    <section class="included-section">
      <h2>What's Included</h2>
      <div class="included-grid">
        <div class="included-item">
          <span class="included-icon">ðŸ“¦</span>
          <div class="included-content">
            <strong>Daily Parquet Files</strong>
            <p>New data published every 24 hours in analysis-ready format</p>
          </div>
        </div>
        <div class="included-item">
          <span class="included-icon">ðŸ“š</span>
          <div class="included-content">
            <strong>Full Historical Archive</strong>
            <p>Access all data from December 2025 onwards</p>
          </div>
        </div>
        <div class="included-item">
          <span class="included-icon">ðŸ”—</span>
          <div class="included-content">
            <strong>Signed Download Links</strong>
            <p>Time-limited secure URLs via Patreon, refreshed regularly</p>
          </div>
        </div>
        <div class="included-item">
          <span class="included-icon">ðŸ“–</span>
          <div class="included-content">
            <strong>Documentation + Examples</strong>
            <p>Schema reference, Python quickstart, and DuckDB examples</p>
          </div>
        </div>
      </div>
    </section>
    
    <!-- FAQ Section -->
    <section class="faq-section">
      <h2>Frequently Asked Questions</h2>
      <div class="faq-list">
        {faqs.map((faq, index) => (
          <details class="faq-item" id={`faq-${index}`}>
            <summary class="faq-question">{faq.question}</summary>
            <p class="faq-answer">{faq.answer}</p>
          </details>
        ))}
      </div>
    </section>
    
    <!-- Disclaimer -->
    <section class="disclaimer-section">
      <p class="disclaimer-text">
        This dataset is descriptive only. It documents observed patterns in market snapshots and social sentiment, but makes no claims about predictive value. No correlation between sentiment and forward returns is implied or claimed. Data is provided for research purposes.
      </p>
    </section>
  </div>
</BaseLayout>

<style>
  /* Archive Context Banner */
  .archive-context {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-4);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    margin-bottom: var(--space-6);
    font-size: 0.9rem;
    color: var(--text-muted);
  }
  
  .context-item strong {
    color: var(--text);
  }
  
  .context-divider {
    color: var(--border);
  }
  
  /* Pricing Section */
  .pricing-section {
    margin-bottom: var(--space-8);
  }
  
  .pricing-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-4);
  }
  
  @media (max-width: 900px) {
    .pricing-grid {
      grid-template-columns: 1fr;
      max-width: 400px;
      margin: 0 auto;
    }
  }
  
  /* Pricing Card */
  .pricing-card {
    display: flex;
    flex-direction: column;
    padding: var(--space-5);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    transition: border-color var(--transition-fast);
  }
  
  .pricing-card:hover {
    border-color: var(--accent);
  }
  
  .pricing-card.highlighted {
    border-color: var(--accent);
    position: relative;
  }
  
  .pricing-card.highlighted::before {
    content: 'Popular';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--accent);
    color: var(--bg);
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    padding: 2px 10px;
    border-radius: 2px;
  }
  
  /* Card Header */
  .card-header {
    margin-bottom: var(--space-4);
  }
  
  .tier-badge {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-muted);
    letter-spacing: 0.05em;
    margin-bottom: var(--space-1);
  }
  
  .tier-name {
    font-size: 1.5rem;
    font-weight: 500;
    margin: 0 0 var(--space-1) 0;
    color: var(--text);
  }
  
  .tier-description {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin: 0;
  }
  
  /* Price */
  .card-price {
    display: flex;
    align-items: baseline;
    margin-bottom: var(--space-4);
    padding-bottom: var(--space-4);
    border-bottom: 1px solid var(--border);
  }
  
  .price-currency {
    font-size: 1.25rem;
    color: var(--text-muted);
    margin-right: 2px;
  }
  
  .price-amount {
    font-size: 2.5rem;
    font-weight: 500;
    color: var(--text);
    line-height: 1;
  }
  
  .price-period {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-left: var(--space-1);
  }
  
  /* Feature List */
  .feature-list {
    list-style: none;
    padding: 0;
    margin: 0 0 var(--space-4) 0;
    flex-grow: 1;
  }
  
  .feature-item {
    display: flex;
    align-items: flex-start;
    gap: var(--space-2);
    font-size: 0.9rem;
    color: var(--text);
    margin-bottom: var(--space-2);
    line-height: 1.4;
  }
  
  .feature-check {
    color: var(--accent);
    font-weight: bold;
    flex-shrink: 0;
  }
  
  /* Use Cases */
  .use-cases {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin: 0 0 var(--space-4) 0;
    padding-top: var(--space-3);
    border-top: 1px solid var(--border);
  }
  
  .use-cases strong {
    color: var(--text);
  }
  
  /* Subscribe Button */
  .subscribe-button {
    display: block;
    width: 100%;
    padding: var(--space-3);
    background: transparent;
    border: 1px solid var(--accent);
    color: var(--accent);
    font-size: 0.9rem;
    font-weight: 500;
    text-align: center;
    text-decoration: none;
    border-radius: 4px;
    transition: all var(--transition-fast);
    margin-top: auto;
  }
  
  .subscribe-button:hover {
    background: var(--accent);
    color: var(--bg);
  }
  
  .pricing-card.highlighted .subscribe-button {
    background: var(--accent);
    color: var(--bg);
  }
  
  .pricing-card.highlighted .subscribe-button:hover {
    background: transparent;
    color: var(--accent);
  }
  
  /* Included Section */
  .included-section {
    margin-bottom: var(--space-8);
  }
  
  .included-section h2 {
    margin-bottom: var(--space-4);
  }
  
  .included-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-4);
  }
  
  @media (max-width: 600px) {
    .included-grid {
      grid-template-columns: 1fr;
    }
  }
  
  .included-item {
    display: flex;
    gap: var(--space-3);
    padding: var(--space-4);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
  }
  
  .included-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
  }
  
  .included-content strong {
    display: block;
    color: var(--text);
    margin-bottom: var(--space-1);
  }
  
  .included-content p {
    margin: 0;
    font-size: 0.9rem;
    color: var(--text-muted);
  }
  
  /* FAQ Section */
  .faq-section {
    margin-bottom: var(--space-8);
  }
  
  .faq-section h2 {
    margin-bottom: var(--space-4);
  }
  
  .faq-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }
  
  .faq-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
  }
  
  .faq-question {
    padding: var(--space-4);
    cursor: pointer;
    font-weight: 500;
    color: var(--text);
    list-style: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .faq-question::-webkit-details-marker {
    display: none;
  }
  
  .faq-question::after {
    content: '+';
    font-size: 1.25rem;
    color: var(--text-muted);
    transition: transform var(--transition-fast);
  }
  
  .faq-item[open] .faq-question::after {
    content: 'âˆ’';
  }
  
  .faq-answer {
    padding: 0 var(--space-4) var(--space-4) var(--space-4);
    margin: 0;
    font-size: 0.9rem;
    color: var(--text-muted);
    line-height: 1.6;
  }
  
  /* Disclaimer */
  .disclaimer-section {
    padding: var(--space-4);
    background: var(--surface);
    border-left: 3px solid var(--accent);
    border-radius: 0 4px 4px 0;
  }
  
  .disclaimer-text {
    margin: 0;
    font-size: 0.85rem;
    color: var(--text-muted);
    line-height: 1.6;
  }
</style>
