---
import BaseLayout from '../layouts/BaseLayout.astro';
import PageHero from '../components/PageHero.astro';
import { 
  loadArtifacts, 
  loadDatasetOverview,
  formatPercent, 
  formatNumber, 
  formatDuration,
  formatReturnPercent
} from '../lib/artifactsData';
import fs from 'node:fs';
import path from 'node:path';

// Load Phase 3A artifact (surface-level overview)
const datasetOverview = loadDatasetOverview();

// Load Phase 4E-1 artifacts (existing coverage table)
const coverageTablePath = path.join(process.cwd(), 'public/data/coverage_table.json');
const datasetSummaryPath = path.join(process.cwd(), 'public/data/dataset_summary.json');
const symbolTablePath = path.join(process.cwd(), 'public/data/symbol_table.json');

let coverageTable = null;
let datasetSummary = null;
let symbolTable = null;

try {
  if (fs.existsSync(coverageTablePath)) {
    coverageTable = JSON.parse(fs.readFileSync(coverageTablePath, 'utf-8'));
  }
  if (fs.existsSync(datasetSummaryPath)) {
    datasetSummary = JSON.parse(fs.readFileSync(datasetSummaryPath, 'utf-8'));
  }
  if (fs.existsSync(symbolTablePath)) {
    symbolTable = JSON.parse(fs.readFileSync(symbolTablePath, 'utf-8'));
  }
} catch (error) {
  console.error('Error loading Phase 4E-1 artifacts:', error);
}

const artifacts = loadArtifacts();
---

<BaseLayout 
  title="Dataset - Instrumetriq"
  description="Dataset details: validated market snapshots with coverage, scale, behavior patterns, and transparency metrics."
>
  <PageHero
    eyebrow="DATASET"
    title="Dataset"
    subtitle="Validated market snapshots: v7 schema with coverage details, scale metrics, and behavioral summaries."
  />
  
  <!-- Warning banner if artifacts unavailable -->
  {!artifacts.available && (
    <div class="warning-banner">
      <strong>Artifacts Status:</strong> Some artifacts are unavailable or failed validation. 
      {artifacts.warnings.map(w => <div>• {w}</div>)}
      Data below may be incomplete.
    </div>
  )}
  
  <!-- Readiness banner (Phase 3A) -->
  {datasetOverview && datasetOverview.scale && (
    <div class="readiness-banner pass">
      <div class="banner-main">
        <strong>Dataset snapshot:</strong> v7 validated entries
        <span class="badge">READY</span>
      </div>
      <div class="banner-details">
        {datasetOverview.scale.entries_scanned} entries scanned
        • {formatNumber(datasetOverview.scale.distinct_symbols)} symbols
        • {datasetOverview.scale.date_range_utc}
      </div>
      <div class="banner-link">
        Source: {datasetOverview.freshness.archive_sample_source}
      </div>
    </div>
  )}
  
  <div class="pageContent">
    <!-- Section 1: Scale & Freshness -->
    {datasetOverview && (
      <section>
        <h2>Scale & Freshness</h2>
        <div class="overview-grid">
          <div class="overview-card">
            <div class="card-label">Entries Scanned</div>
            <div class="card-value">{formatNumber(datasetOverview.scale.entries_scanned)}</div>
          </div>
          <div class="overview-card">
            <div class="card-label">Distinct Symbols</div>
            <div class="card-value">{formatNumber(datasetOverview.scale.distinct_symbols)}</div>
          </div>
          <div class="overview-card">
            <div class="card-label">Date Range (UTC)</div>
            <div class="card-value">{datasetOverview.scale.date_range_utc}</div>
          </div>
          {datasetOverview.scale.last_entry_ts_utc && (
            <div class="overview-card">
              <div class="card-label">Last Entry</div>
              <div class="card-value">{datasetOverview.scale.last_entry_ts_utc}</div>
            </div>
          )}
        </div>
        <p class="freshness-note">
          <strong>Source:</strong> {datasetOverview.freshness.archive_sample_source}
          <br />
          <em>{datasetOverview.freshness.notes}</em>
        </p>
      </section>
    )}
    
    <!-- Section 2: Coverage (existing Phase 4E-1 table) -->
    {coverageTable && coverageTable.feature_groups && (
      <section>
        <h2>What We Collect</h2>
        <p>
          Each entry is a market snapshot. Feature groups show which data blocks are present across snapshots. 
          A group's "present rate" indicates the percentage of validated entries that include that feature block.
        </p>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Feature Group</th>
                <th>Present Rate</th>
                <th>Notes</th>
                <th>Example Metric</th>
              </tr>
            </thead>
            <tbody>
              {coverageTable.feature_groups.map((group: any) => {
                const rate = group.present_rate_pct / 100;
                let exampleText = '—';
                
                if (typeof group.example_metric_value === 'number') {
                  // Numeric value - format with label
                  const formattedValue = Number.isInteger(group.example_metric_value) 
                    ? formatNumber(group.example_metric_value)
                    : group.example_metric_value.toFixed(2);
                  exampleText = `${group.example_metric_label}: ${formattedValue}`;
                } else if (typeof group.example_metric_value === 'string') {
                  // String explanation for 0% groups
                  exampleText = group.example_metric_value;
                }
                
                return (
                  <tr>
                    <td><code>{group.group}</code></td>
                    <td>{formatPercent(rate)}</td>
                    <td class={rate === 0 ? 'text-muted' : ''}>{group.example_metric_note || '—'}</td>
                    <td class={rate === 0 ? 'text-muted' : ''}>{exampleText}</td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </section>
    )}
    
    <!-- Section 3: Preview Row -->
    {datasetOverview && datasetOverview.preview_row && (
      <section>
        <h2>Preview Row</h2>
        <p>
          One redacted sample entry from the dataset. 
          No timestamps, author names, tweet text, or IDs are shown.
        </p>
        <div class="table-wrapper">
          <table class="data-table preview-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody>
              {Object.entries(datasetOverview.preview_row).map(([key, value]) => (
                <tr>
                  <td><code>{key}</code></td>
                  <td>
                    {typeof value === 'number' 
                      ? (Number.isInteger(value) ? formatNumber(value) : value.toFixed(4))
                      : String(value)
                    }
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </section>
    )}
    
    <!-- Section 4: Non-Claims -->
    {datasetOverview && datasetOverview.non_claims_block && (
      <section>
        <h2>Dataset Disclaimers</h2>
        <div class="non-claims-box">
          <ul>
            {datasetOverview.non_claims_block.map((item: string) => (
              <li>{item}</li>
            ))}
          </ul>
        </div>
      </section>
    )}
    
    <!-- OLD SECTIONS BELOW (Phase 4E-1) - keep for backwards compatibility -->
    <!-- Section OLD-2: Scale -->
    {datasetSummary && datasetSummary.scale && (
      <section>
        <h2>Scale (Legacy)</h2>
        <div class="scale-grid">
          <div class="scale-card">
            <div class="scale-label">Days Running</div>
            <div class="scale-value">{datasetSummary.scale.days_running}</div>
          </div>
          <div class="scale-card">
            <div class="scale-label">Total Usable</div>
            <div class="scale-value">{formatNumber(datasetSummary.scale.total_usable_entries)}</div>
          </div>
          <div class="scale-card">
            <div class="scale-label">Avg Per Day</div>
            <div class="scale-value">{formatNumber(datasetSummary.scale.avg_entries_per_day)}</div>
          </div>
          <div class="scale-card">
            <div class="scale-label">Distinct Symbols</div>
            <div class="scale-value">{formatNumber(datasetSummary.scale.distinct_symbols)}</div>
          </div>
        </div>
        {datasetSummary.posts_scored && (
          <p class="posts-scored-line">
            Posts scored: {formatNumber(datasetSummary.posts_scored.total_posts)} 
            (from {formatNumber(datasetSummary.posts_scored.from_entries)} entries)
          </p>
        )}
      </section>
    )}
    
    <!-- Section 3: Preview Row -->
    {artifacts.preview && (
      <section>
        <h2>Dataset Preview Row</h2>
        <p>
          Example entry showing typical fields. This row is redacted: no timestamps, no URLs, forward return is bucketed.
        </p>
        <div class="table-wrapper">
          <table class="data-table preview-table-mono">
            <thead>
              <tr>
                <th>Field</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody>
              {Object.entries(artifacts.preview.row).map(([key, value]) => (
                <tr>
                  <td><code>{key}</code></td>
                  <td class="mono-value">{typeof value === 'number' ? value.toFixed(6) : String(value)}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </section>
    )}
    
    <!-- Section 4: Sentiment Buckets -->
    {datasetSummary && datasetSummary.sentiment_buckets && (
      <section>
        <h2>Sentiment Distribution</h2>
        {datasetSummary.sentiment_buckets.reason_unavailable ? (
          <div class="unavailable-notice">
            <p><strong>Not available yet:</strong> {datasetSummary.sentiment_buckets.reason_unavailable}</p>
            <p class="text-muted">This section will show the distribution of sentiment scores across entries when the data becomes available. This is purely descriptive and makes no claims about predictive value or market correlation.</p>
          </div>
        ) : datasetSummary.sentiment_buckets.buckets && datasetSummary.sentiment_buckets.buckets.length > 0 ? (
          <>
            <p>
              Distribution of entries across sentiment score ranges. 
              <strong>This is descriptive only</strong> — it shows what was observed, not what might predict future outcomes. 
              No correlation with returns or trading edge is implied or claimed.
            </p>
            <p class="disclaimer-emphasis">{datasetSummary.sentiment_buckets.disclaimer}</p>
            <div class="table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Sentiment Range</th>
                    <th>Entry Count</th>
                  </tr>
                </thead>
                <tbody>
                  {datasetSummary.sentiment_buckets.buckets.map((bucket: any) => (
                    <tr>
                      <td><code>{bucket.label}</code></td>
                      <td>{formatNumber(bucket.n_entries)}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </>
        ) : (
          <p class="text-muted">No sentiment bucket data available.</p>
        )}
      </section>
    )}
    
    {datasetSummary && datasetSummary.activity_regimes && datasetSummary.activity_regimes.bins && (
      <section>
        <h2>Activity Regimes by Post Volume</h2>
        <p>
          <strong>Activity regime</strong> is based on posts_total observed in the sentiment window for a session. 
          Entries are grouped by post volume to show market characteristics across different activity levels.
        </p>
        <p class="definition-note">{datasetSummary.activity_regimes.definition}</p>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Posts Range</th>
                <th>Entries</th>
                <th>Median Spread (bps)</th>
                <th>P90 Spread (bps)</th>
              </tr>
            </thead>
            <tbody>
              {datasetSummary.activity_regimes.bins.map((bin: any) => (
                <tr>
                  <td><code>{bin.label}</code></td>
                  <td>{formatNumber(bin.n_entries)}</td>
                  <td>{bin.metrics.median_spread_bps ? bin.metrics.median_spread_bps.toFixed(2) : '—'}</td>
                  <td>{bin.metrics.p90_spread_bps ? bin.metrics.p90_spread_bps.toFixed(2) : '—'}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </section>
    )}
    
    <!-- Hybrid Decision Breakdown removed per Phase 4E-2 requirements -->
    
    {artifacts.confidence && (
      <section>
        <h2>Confidence vs Disagreement</h2>
        <p>
          Disagreement rate binned by referee confidence. Shows when referee overrides primary decision.
        </p>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Confidence Bin</th>
                <th>N</th>
                <th>Disagreement Rate</th>
              </tr>
            </thead>
            <tbody>
              {artifacts.confidence.bins
                .filter(bin => bin.sample_count > 0)
                .map(bin => (
                  <tr>
                    <td><code>{bin.bin_label}</code></td>
                    <td>{formatNumber(bin.sample_count)}</td>
                    <td>{formatPercent(bin.disagreement_rate)}</td>
                  </tr>
                ))}
            </tbody>
          </table>
        </div>
      </section>
    )}
    
    <!-- Section 6: Symbol Table -->
    {symbolTable && symbolTable.symbols && (
      <section>
        <h2>Symbol Table</h2>
        <p class="session-definition">
          A session is one monitoring window (about 2 hours) for a symbol in the active watchlist.
        </p>
        <div class="symbol-table-controls">
          <input 
            type="text" 
            id="symbolSearch" 
            placeholder="Search symbols..."
            class="symbol-search-input"
          />
          <div class="symbol-count-display" id="symbolCount">
            Showing <span id="visibleCount">50</span> of <span id="totalCount">{symbolTable.total_symbols}</span> symbols
          </div>
        </div>
        <div class="table-wrapper">
          <table class="data-table symbol-table" id="symbolTableElement">
            <thead>
              <tr>
                <th data-sort="symbol" class="sortable">Symbol <span class="sort-indicator"></span></th>
                <th data-sort="sessions" class="sortable">Sessions <span class="sort-indicator"></span></th>
                <th data-sort="median_posts" class="sortable">Median Posts <span class="sort-indicator"></span></th>
                <th data-sort="p90_posts" class="sortable">P90 Posts <span class="sort-indicator"></span></th>
                <th data-sort="silence_rate" class="sortable">Silence Rate % <span class="sort-indicator"></span></th>
                <th data-sort="median_spread" class="sortable">Median Spread (bps) <span class="sort-indicator"></span></th>
              </tr>
            </thead>
            <tbody id="symbolTableBody">
              {/* Rows populated by client-side script */}
            </tbody>
          </table>
        </div>
        <button id="showAllButton" class="show-all-btn" style="display: none;">Show all results</button>
      </section>
    )}
    
    <!-- Honesty Block -->
    <section>
      <h2>What We Do Not Claim</h2>
      <div class="honesty-block">
        <ul>
          <li><strong>No live signals:</strong> This dataset is for research and analysis, not real-time trading</li>
          <li><strong>No guaranteed correlation:</strong> Patterns shown are descriptive, not predictive</li>
          <li><strong>No post-hoc filtering:</strong> Data passes automated gates only, no cherry-picking</li>
          <li><strong>No execution advice:</strong> This is not financial advice or investment guidance</li>
        </ul>
      </div>
    </section>
    
    <!-- Original context sections -->
    <section>
      <h2>About the Dataset</h2>
      <p>
        A record is a single validated <strong>v7 snapshot</strong>—frozen at admission and required to pass dataset health gates (700+ spot samples minimum). Each snapshot captures a moment in time, combining market microstructure, high-resolution price samples, and aggregated social sentiment windows.
      </p>
      <p>
        See <a href="/status">Status</a> for current validated record counts.
      </p>
    </section>
    
    <section>
      <h2>Dataset Structure</h2>
      <p>
        Detailed schema documentation, file formats, and field definitions will be provided with the first public release. Future documentation will include versioned schemas, migration guides, and format specifications.
      </p>
    </section>
    
    <section>
      <h2>Access & Licensing</h2>
      <p>
        Public releases will include comprehensive documentation and a Python quickstart for reading and exploring the data. Access terms and licensing details will be finalized and published alongside the first release.
      </p>
    </section>
  </div>
</BaseLayout>

<script is:inline define:vars={{ symbolTableData: symbolTable }}>
  // Symbol table client-side functionality
  if (symbolTableData && symbolTableData.symbols) {
    const symbols = symbolTableData.symbols;
    const tbody = document.getElementById('symbolTableBody');
    const searchInput = document.getElementById('symbolSearch');
    const showAllButton = document.getElementById('showAllButton');
    const visibleCountSpan = document.getElementById('visibleCount');
    
    let filteredSymbols = [...symbols];
    let currentSort = { column: null, direction: 'asc' };
    let showAll = false;
    
    function formatValue(value) {
      if (value === null || value === undefined) return '\u2014';
      if (typeof value === 'number') {
        return Number.isInteger(value) ? value.toLocaleString() : value.toFixed(2);
      }
      return String(value);
    }
    
    function renderTable() {
      const displayLimit = showAll ? filteredSymbols.length : Math.min(50, filteredSymbols.length);
      const displaySymbols = filteredSymbols.slice(0, displayLimit);
      
      tbody.innerHTML = displaySymbols.map(sym => {
        return `
          <tr>
            <td><code>${sym.symbol}</code></td>
            <td>${formatValue(sym.sessions)}</td>
            <td>${formatValue(sym.activity?.median_posts_last_cycle)}</td>
            <td>${formatValue(sym.activity?.p90_posts_last_cycle)}</td>
            <td>${formatValue(sym.activity?.silence_rate_pct)}</td>
            <td>${formatValue(sym.market_context?.median_spread_bps)}</td>
          </tr>
        `;
      }).join('');
      
      visibleCountSpan.textContent = displayLimit;
      
      if (filteredSymbols.length > 50 && !showAll) {
        showAllButton.style.display = 'inline-block';
      } else {
        showAllButton.style.display = 'none';
      }
    }
    
    function sortSymbols(column) {
      if (currentSort.column === column) {
        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
      } else {
        currentSort.column = column;
        currentSort.direction = 'asc';
      }
      
      filteredSymbols.sort((a, b) => {
        let aVal, bVal;
        
        switch (column) {
          case 'symbol':
            aVal = a.symbol;
            bVal = b.symbol;
            break;
          case 'sessions':
            aVal = a.sessions || 0;
            bVal = b.sessions || 0;
            break;
          case 'median_posts':
            aVal = a.activity?.median_posts_last_cycle || 0;
            bVal = b.activity?.median_posts_last_cycle || 0;
            break;
          case 'p90_posts':
            aVal = a.activity?.p90_posts_last_cycle || 0;
            bVal = b.activity?.p90_posts_last_cycle || 0;
            break;
          case 'silence_rate':
            aVal = a.activity?.silence_rate_pct || 0;
            bVal = b.activity?.silence_rate_pct || 0;
            break;
          case 'median_spread':
            aVal = a.market_context?.median_spread_bps || 0;
            bVal = b.market_context?.median_spread_bps || 0;
            break;
          default:
            return 0;
        }
        
        if (typeof aVal === 'string') {
          const cmp = aVal.localeCompare(bVal);
          return currentSort.direction === 'asc' ? cmp : -cmp;
        } else {
          return currentSort.direction === 'asc' ? aVal - bVal : bVal - aVal;
        }
      });
      
      // Update sort indicators
      document.querySelectorAll('.symbol-table th.sortable').forEach(th => {
        th.classList.remove('sort-asc', 'sort-desc');
        if (th.dataset.sort === column) {
          th.classList.add(`sort-${currentSort.direction}`);
        }
      });
      
      showAll = false;
      renderTable();
    }
    
    function filterSymbols() {
      const query = searchInput.value.toLowerCase().trim();
      
      if (!query) {
        filteredSymbols = [...symbols];
      } else {
        filteredSymbols = symbols.filter(sym => 
          sym.symbol.toLowerCase().includes(query)
        );
      }
      
      showAll = false;
      renderTable();
    }
    
    // Event listeners
    searchInput.addEventListener('input', filterSymbols);
    
    showAllButton.addEventListener('click', () => {
      showAll = true;
      renderTable();
    });
    
    document.querySelectorAll('.symbol-table th.sortable').forEach(th => {
      th.addEventListener('click', () => {
        sortSymbols(th.dataset.sort);
      });
    });
    
    // Initial render (sort by sessions descending)
    sortSymbols('sessions');
  }
</script>

<style>
  .warning-banner {
    background-color: #fee;
    border-left: 4px solid #f44;
    padding: var(--space-3) var(--space-4);
    margin-bottom: var(--space-4);
    color: #600;
  }
  
  .readiness-banner {
    padding: var(--space-4);
    margin-bottom: var(--space-5);
    border-radius: 4px;
    border-left: 4px solid var(--accent);
  }
  
  .readiness-banner.pass {
    background-color: rgba(16, 185, 129, 0.1);
    border-color: #10b981;
  }
  
  .readiness-banner.fail {
    background-color: rgba(239, 68, 68, 0.1);
    border-color: #ef4444;
  }
  
  .banner-main {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 1.1rem;
    margin-bottom: var(--space-2);
  }
  
  .banner-main .badge {
    padding: 2px 8px;
    border-radius: 3px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }
  
  .readiness-banner.pass .badge {
    background-color: #10b981;
    color: white;
  }
  
  .readiness-banner.fail .badge {
    background-color: #ef4444;
    color: white;
  }
  
  .banner-details {
    color: var(--text-muted);
    font-size: 0.9rem;
    margin-bottom: var(--space-2);
  }
  
  .banner-details .error-hint {
    color: #ef4444;
    font-weight: 500;
  }
  
  .banner-link {
    font-size: 0.9rem;
  }
  
  .scale-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-3);
    margin-top: var(--space-4);
  }
  
  .scale-card {
    padding: var(--space-4);
    background-color: var(--panel2);
    border-radius: 4px;
    text-align: center;
  }
  
  .scale-label {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-bottom: var(--space-2);
  }
  
  .scale-value {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text);
  }
  
  .table-wrapper {
    overflow-x: auto;
    margin-top: var(--space-4);
  }
  
  .data-table {
    width: 100%;
    border-collapse: collapse;
    background-color: var(--panel2);
    font-size: 0.9rem;
  }
  
  .data-table th {
    background-color: var(--panel);
    padding: var(--space-3);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--accent-dim);
  }
  
  .data-table td {
    padding: var(--space-3);
    border-bottom: 1px solid var(--panel);
  }
  
  .data-table tbody tr:hover {
    background-color: rgba(0, 188, 212, 0.05);
  }
  
  .data-table code {
    font-family: 'Courier New', monospace;
    font-size: 0.85em;
    color: var(--accent);
  }
  
  .preview-table-mono .mono-value {
    font-family: 'Lucida Sans Typewriter', 'Lucida Console', 'Consolas', 'Monaco', monospace;
    font-size: 0.85rem;
  }
  
  .posts-scored-line {
    margin-top: var(--space-4);
    padding: var(--space-3);
    background-color: var(--panel2);
    border-left: 3px solid var(--accent);
    font-size: 0.95rem;
  }
  
  .text-muted {
    color: var(--text-muted);
    font-style: italic;
  }
  
  .unavailable-notice {
    padding: var(--space-4);
    background-color: rgba(255, 193, 7, 0.1);
    border-left: 4px solid #ffc107;
    border-radius: 4px;
    margin-top: var(--space-3);
  }
  
  .unavailable-notice strong {
    color: #f59e0b;
  }
  
  .disclaimer-emphasis {
    font-style: italic;
    color: var(--text-muted);
    margin-bottom: var(--space-3);
  }
  
  .definition-note {
    font-size: 0.9rem;
    color: var(--text-muted);
    font-style: italic;
    margin-bottom: var(--space-3);
  }
  
  .session-definition {
    font-style: italic;
    color: var(--text-muted);
    margin-bottom: var(--space-4);
    padding: var(--space-2) var(--space-3);
    background-color: var(--panel2);
    border-left: 3px solid var(--accent-dim);
  }
  
  .symbol-table-controls {
    display: flex;
    gap: var(--space-3);
    align-items: center;
    margin-bottom: var(--space-3);
    flex-wrap: wrap;
  }
  
  .symbol-search-input {
    flex: 1;
    min-width: 200px;
    padding: var(--space-2) var(--space-3);
    border: 1px solid var(--accent-dim);
    border-radius: 4px;
    background-color: var(--panel2);
    color: var(--text);
    font-size: 0.9rem;
  }
  
  .symbol-search-input:focus {
    outline: none;
    border-color: var(--accent);
  }
  
  .symbol-count-display {
    color: var(--text-muted);
    font-size: 0.9rem;
  }
  
  .symbol-table {
    font-size: 0.85rem;
  }
  
  .symbol-table th.sortable {
    cursor: pointer;
    user-select: none;
  }
  
  .symbol-table th.sortable:hover {
    background-color: var(--accent-dim);
  }
  
  .symbol-table .sort-indicator {
    display: inline-block;
    width: 12px;
    margin-left: 4px;
  }
  
  .symbol-table th.sort-asc .sort-indicator::after {
    content: '▲';
    font-size: 0.7em;
  }
  
  .symbol-table th.sort-desc .sort-indicator::after {
    content: '▼';
    font-size: 0.7em;
  }
  
  .show-all-btn {
    margin-top: var(--space-3);
    padding: var(--space-2) var(--space-4);
    background-color: var(--accent);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9rem;
  }
  
  .show-all-btn:hover {
    background-color: var(--accent-bright);
  }
  
  .note {
    margin-top: var(--space-3);
    font-size: 0.9rem;
    color: var(--text-muted);
    font-style: italic;
  }
  
  .honesty-block {
    padding: var(--space-4);
    background-color: var(--panel2);
    border-left: 4px solid #ef4444;
    border-radius: 4px;
    margin-top: var(--space-4);
  }
  
  .honesty-block ul {
    margin: 0;
    padding-left: var(--space-4);
  }
  
  .honesty-block li {
    margin-bottom: var(--space-2);
    color: var(--text-muted);
  }
  
  /* Phase 3A styles */
  .overview-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: var(--space-3);
    margin-top: var(--space-4);
  }
  
  .overview-card {
    padding: var(--space-4);
    background-color: var(--panel2);
    border-radius: 4px;
    text-align: center;
  }
  
  .card-label {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-bottom: var(--space-2);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .card-value {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text);
    word-break: break-all;
  }
  
  .freshness-note {
    margin-top: var(--space-4);
    padding: var(--space-3);
    background-color: var(--panel2);
    border-radius: 4px;
    font-size: 0.9rem;
  }
  
  .preview-table tbody td:first-child {
    font-family: 'Courier New', monospace;
    color: var(--accent);
  }
  
  .preview-table tbody td:last-child {
    font-family: 'Courier New', monospace;
    color: var(--text);
  }
  
  .non-claims-box {
    padding: var(--space-4);
    background-color: var(--panel2);
    border-left: 4px solid #f59e0b;
    border-radius: 4px;
    margin-top: var(--space-4);
  }
  
  .non-claims-box ul {
    margin: 0;
    padding-left: var(--space-4);
  }
  
  .non-claims-box li {
    margin-bottom: var(--space-3);
    color: var(--text-muted);
    line-height: 1.6;
  }
